<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="exec">
    <p>執行系統命令並回傳其輸出結果。</p>
    <p>可以將節點設定為等待命令執行完成，或者持續輸出命令執行所即時產生的訊息。</p>
    <p>執行的命令可以在節點中直接設定，也可以由外部輸入的訊息所提供。</p>

    <h3>輸入</h3>
    <dl class="message-properties">
        <dt class="optional">payload <span class="property-type">字串</span></dt>
        <dd>如果套用此設定，其內容將幫當成額外的輸入參數附加到目前準備執行的命令中。</dd>
        <dt class="optional">kill <span class="property-type">字串</span></dt>
        <dd>指定 kill 信號，發送到現有 exec 節點正在運作的程序。</dd>
        <dt class="optional">pid <span class="property-type">數值|字串</span></dt>
        <dd>要殺死的現有 exec 節點正在運作的程序 ID</dd>
    </dl>

    <h3>輸出</h3>
    <ol class="node-ports">
        <li>標准輸出(stdout)
            <dl class="message-properties">
                <dt>payload <span class="property-type">字串</span></dt>
                <dd>命令的標准輸出。</dd>
            </dl>
            <dl class="message-properties">
                <dt>rc <span class="property-type">object</span></dt>
                <dd>exec 模式下，回傳狀態碼物件的副本（也會輸出至 output 輸出連節點 3）</dd>
            </dl>
        </li>
        <li>標准error輸出(stderr)
            <dl class="message-properties">
                <dt>payload <span class="property-type">字串</span></dt>
                <dd>命令的標准錯誤輸出。</dd>
            </dl>
            <dl class="message-properties">
                <dt>rc <span class="property-type">object</span></dt>
                <dd>exec 模式下，回傳狀態碼物件的副本（也會輸出至 output 輸出連節點 3）</dd>
            </dl>
        </li>
        <li>返回程式碼
            <dl class="message-properties">
                <dt>payload <span class="property-type">object</span></dt>
                <dd>回傳物件包括狀態碼、<code>message</code>、<code>signal</code> 屬性。</dd>
            </dl>
        </li>
    </ol>
    <h3>詳細</h3>
    <p>預設情況下，使用<code>exec</code>系統呼叫來執行命令，等待命令執行完成，然後回傳輸出結果。例如，命令執行成功的回傳狀態碼應爲<code>{code：0}</code>。</p>
    <p>另一種情況下，可以選擇使用<code>spawn</code>代替，它會在命令執行時從 stdout 和 stderr 持續回傳輸出，通常一次一行。命令執行完成並結束後，它將在第三個輸出連接點上輸出一個物件。例如，成功的命令應回傳狀態碼<code>{code：0}</code>。</p>
    <p>錯誤可能會在第三個輸出連接點的<code>msg.payload</code>上包括額外的資訊，例如<code>message</code>字串、<code>signal</code>字串。</p>
    <p>執行的命令是在節點內定義的，帶有附加<code>msg.payload</code>的選項和其他的參數。</p>
    <p>帶空格的命令或參數應該用引號引起來，例如：<code>"這是一個參數"</code></p>
    <p>輸出的<code>payload</code>通常是<i>字串</i>類型，若偵測到非 UTF-8 字元，它會是<i>buffer</i>類型。</p>
    <p>節點處於正在執行的狀態時，該節點的狀態圖示和程序 PID 將可見，可以利用<code>Status</code>節點來讀取狀態的變更。</p>
    <h4>終止命令程序</h4>
    <p>輸入<code>msg.kill</code>將可以終止一個正在執行的命令程序。<code>msg.kill</code>應該要包含發送的信號類型並以字串表示，例如<code>SIGINT</code>、<code>SIGQUIT</code>或<code>SIGHUP</code>。如果設定爲空字串，則預設爲<code>SIGTERM</code>。</p>
    <p>如果節點有多個命令程序在執行，則必須設定<code>msg.pid</code>已指定要終止的程序 PID。</p>
    <p>如果<code>超時</code>選項被設定了一個時間，代表命令程序沒有在指定的秒數內完成就強制終止。</p>
    <p>提示：如果執行的是 Python 應用程序，則可能需要代入<code>-u</code>參數來停止 Python 對結果輸出進行緩存。</p>
</script>
